<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: History.txt</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>History.txt</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>History.txt
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat May 03 21:00:23 -0700 2008</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h2>0.9.3 2008-04-10</h2>
<p>
<a href="../classes/Skynet/Manager.html">Skynet::Manager</a> and Skynet
Script Runner
</p>
<pre>
 - Rewrote how Skynet workers and skynet manager talks on each machine.  See below for more info

 - Support starting Skynet with ./script/skynet start and stop to daemonize
 - Gracefully handles trying to start skynet more than once
 - Close file handles on exec.
     Skynet::Worker and Skynet::Manager now call Skynet.fork_and_exec instead of their own versions.
     Skynet.fork_and_exec prevents file descriptor exhaustion by calling Skynet.close_file_handles.
     Skynet::Manager detatches from console by calling Skynet.close_console

 - Dramatically improved Skynet shutdown time
 - You now have to specify your PIDFILE and LOGFILE dirs and files differently. This will break all old skynet runners. Sorry.
 - Skynet runner handles default config variables better
 - Fix serious bug in Skynet::Partitioners::RecombineAndSplit where it wouldn't handle empty results well.
 - Fixed Skynet::Partitioners::ArrayDataSplitByFirstEntry to handle strings as keys better
 - Added Skynet::Job.results_by_job_id to retrieve results from asyncronous jobs
 - Added printlog logging method which always prints to the log as [LOG]
 - Deprecated Skynet.new to Skynet.start
 - Mysql Message Queue Adapter - Make delete_expired_messages much safer.
 - ActiveRecord::Base.distributed_find - Patch submitted by Lourens Naude (lourens@methodmissing.com) which checks the model for the primary_key name as opposed to assuming it is
  'id'
 - We don't want to use rails constantize so I've temporarily borrowed the method from ActiveSupport inflector and added it to skynet_ruby_extensions.
 - Fix bug in Job comment where it referenced MapreduceTest instead of Skynet::MapreduceTest
 - Fix tests. For some reason you still can't run ALL the test at once with rake test, but if the files are run individually they all pass.
 - Change mysql text fields to longtext in migration and schema files
 - Include some extras including our init.d script, our nagios monitoring script, rails controller and view for monitoring
 - Created a new skynet rails initializer which gets installed from skynet_install --rails
 - Modified the skynet_install skynet runner to take skynet initializer into account
 - Skynet::ActiveRecordExtensions Fixed a bug where it would fail if your table had fewer than 1000 rows.  It performs a count
  first now to make sure there are enough rows.
 - Introduced some new Skynet::Config methods for getting logfile and pidfile locations
</pre>
<p>
Skynet Manager/Worker Refactor
</p>
<pre>
  The workers used to publish their worker statuses to the skynet_worker_queue which lived in the same Q space as the skynet_message_queue.  skynet managers would then query that queue for their workers' statuses.   This was a very inefficient use of central resources.    The rewrite split the message_queue_adapter into a Skynet::MessageQueueAdapter and a Skynet::WorkerQueueAdapter, such that the message queue and worker queue could use different adapters.  I think made the default worker_queue adapter be the TupleSpace adapter.   With this adapter, each box running a manager and workers will end up running its own TupleSpace server.  The workers will put their statuses on that LOCAL q, which the managers pick up.
 The other difference is that the manager no longer leaves worker_queue entries on the Q. Instead it just takes them off the Q as soon as it sees them and caches the information about its workers locally.  It also saves that information to a file in case the manager dies or is stopped.
</pre>
<p>
As a consequence of decentralizing worker stats, you now have to ask all
your managers for their individual stats along with the main message queue
stats. Added a stats_for_hosts method to <a
href="../classes/Skynet/Manager.html">Skynet::Manager</a> which aggregates
stats accross many managers.
</p>
<h2>0.9.2 2008-01-22</h2>
<p>
Highlights:
</p>
<pre>
 - Multiple Message Queues
 - Many more Job options including options to control how jobs are distributed.
 - The various options for how a job is run has been made much clearer.
 - The Mysql Message Queue Adapter has been optimized and made more reliable.
 - You can now control how many times skynet retries failed master, map and reduce tasks.
 - Large data sets can now be streamed to the queue.
</pre>
<p>
Details:
</p>
<p>
Active::Record#distributed_find
</p>
<pre>
  - Active Record distributed_find now handles REALLY large sets by breaking them into seperate jobs. 1MM models per master broken into ranges of 1000.
</pre>
<p>
<a href="../classes/Skynet/Job.html">Skynet::Job</a>
</p>
<pre>
  - code path through Skynet::Job is now clear. There are 3 ways to run Skynet::Job. Local Master (default), Remote Master, Async (implies remote master)
  - Skynet::Job supports keep_map_tasks and keep_reduce_tasks settings.
    If true, the master will run the tasks locally.
    If a number is provided, the master will run the tasks locally if there are LESS THAN OR EQUAL TO the number provided
    There are also Skynet::CONFIG settings for defaults. DEFAULT_KEEP_REDUCE_TASKS, DEFAULT_KEEP_MAP_TASKS
    I can see there being a problem with the timeouts being a little off... Since your kinda in a master and kinda in a map or reduce timeout.  The task timeouts will be correct at least.  Though, you won't get the benefit of redoes yet.
  - Skynet::Job now supports setting RETRY times per job by MASTER, MAP and REDUCE. So you can have a MASTER_RETRY=0, but have MAP_RETRY=2 and REDUCE_RETRY=3.  There are now defaults for those as well :DEFAULT_MASTER_RETRY, :DEFAULT_MAP_RETRY, :DEFAULT_REDUCE_RETRY.    If a message passes its RETRY it will be marked with an iteration of -1.   delete_expired_messages removes those messages as well.  These show up in the stats as :failed_tasks.  Skynet::Task and Skynet::Message now have retry fields denoting the maximum number of retries.
  - You can now pass queue_id or queue to Skynet::Job
  - There is now a :MAX_RETRIES config setting that controls how many iterations Skynet will even look for tasks as well.
  - You can now stream map_data to the queue by passing an Enumerable for your map_data
  - Refactored Skynet::Job to be much cleaner and easier to test.
  - Skynet::Job now has access to a local queue which it can treat almost like the real one.
  - deprecate Skynet::Job#run_master
  - rename reduce_partitioner method to just reduce_partition
  - Skynet::Job has better support for running tasks locally.  A job may run tasks in its own process if
    you are running in solo mode, you've made a &quot;single&quot; job, or you set the keep_map_tasks or keep_reduce_tasks below.
    When a job runs tasks locally it now honors the retry settings and timeouts.
  - Skynet::Job and Skynet::AsyncJob are now almost identical.  In fact you can just use Skynet::Job and tell it to run async.
  - Skynet::Job Changed map_tasks and reduce_tasks to mappers and reducers respectively.  This was to remove the ambiguity between the actual map/reduce tasks and the number of mappers/reducers desired.
  - Skynet::Jobs can not be told what queue to use for that job by passing :queue or :queue_id DEFAULT 0
  - Skynet::Job won't call the reduce_partitioner if there are no valid results from the map_step.
</pre>
<p>
<a href="../classes/MapreduceHelper.html">MapreduceHelper</a> mixin
</p>
<pre>
  - You can include MapreduceHelper into your class and then implement self.map_each and self.reduce_each methods.  The included self.map and self.reduce methods will handle iterating over the map_data and reduce_data, passing each element to your map_each and reduce_each methods respectively.  They will also handle error handling within that loop to make sure even if a single map or reduce fails, processing will continue.  If you do not want processing to continue if a map fails, do not use the MapreduceHelper mixin.
</pre>
<p>
Multiple Message Queues!
</p>
<pre>
  - Add the ability to have multiple message queues in the same table message_queue_table.
  - You can start skynet with a --queue_id or --queue option to determine which queue workers should look in.
  - Skynet::Jobs can not be told what queue to use for that job by passing :queue or :queue_id.  DEFAULT 0
  - Queues can be configred via Skynet::CONFIG[:MESSAGE_QUEUES] = [] which comes with an array of queues id 1 through 10 named &quot;one&quot; through &quot;ten&quot;
</pre>
<p>
Skynet Console
</p>
<pre>
  - You now start the skynet console by running 'skynet console' at the command line.   There is no longer a skynet_console app.
  - The console now loads the configs that are in your local skynet script.
</pre>
<p>
<a href="../classes/Skynet/Config.html">Skynet::Config</a>
</p>
<pre>
  - Added Skynet.silent {} Runs your code with no debugging output.
  - Made sure all config options for TupleSpace? adapter begin with TS and all Mysql adapter CONFIG settings start with MYSQL.
  - There is now a :MAX_RETRIES config setting that controls how many iterations Skynet will even look for tasks as well.
</pre>
<p>
<a href="../classes/Skynet/Partitioners.html">Skynet::Partitioners</a>
</p>
<pre>
  - Created a Skynet::Partitioners class where various partitioners can be found.  To specify one of them merely provide that specific Skynet::Partitioners subclass as your reduce_partitioner in your Skynet::Job
</pre>
<p>
Skynet Install
</p>
<pre>
 - skynet_install now has a --mysql option.  This installs the migration as well as a skynet_schema.sql file.
</pre>
<p>
Mysql Message Queue Adapter
</p>
<pre>
  - You can now configure your database options outside of rails with Skynet::CONFIG[:MYSQL_*] options.
  - Mysql adapter now updates the updated_on time of rows in skynet_message_queues
  - Fixed Mysql Message Adaptor to take_next_task safer and more efficiently.   There seems to be far less risk of a race condition where two workers would take the same task.
  - Eliminated 1 db update per every task taken making it MUCH more efficient.
  - Skynet::MessageQueueAdaptor::Mysql now tries to reconnect if it gets disconnected.   This was to solve the &quot;Mysql Server has Gone Away&quot; errors.
  - Implemented version_active? in mysql message queue adapter.   It's a way for workers to check to see if a version is still in the queue.
</pre>
<p>
<a href="../classes/Skynet/Task.html">Skynet::Task</a>
</p>
<pre>
  - Skynet::Task#master_task takes care of creating the master job and task now. I have mixed feelings about this.
  - ENFORCED TIMEOUTS - Even though a master might give up on a worker if it didn't respond in time, there was nothing to step any given worker from running forever.  We now enforce the timeouts (master_timeout, map_timeout, reduce_timeout) given in Skynet::Job using the Timeout module.  This causes a Timeout::Error to be thrown.   If you are using the mysql adapter, this can cause strange results sometimes.   If the Timeout error is thrown during a DB query, ActiveRecord will throw an ActiveRecord::StatementInvalid exception which includes the Timeout::Error exception in it.  Not sure how to prevent that from happening.
</pre>
<p>
<a href="../classes/Skynet/Worker.html">Skynet::Worker</a>
</p>
<pre>
  - Workers now have a Skynet::CONFIG[:WORKER_MAX_PROCESSED] setting to control when to respawn based on how many that worker has processed.
  - You can start skynet with a --queue_id or --queue option to determine which queue workers should look in.
  - Workers do not restart until there are no more items in the queue of that version.
</pre>
<p>
<a href="../classes/Skynet/Message.html">Skynet::Message</a>
</p>
<pre>
  - Skynet::Message now stores fields as an array.  It is far more efficient now as well.
</pre>
<p>
Now 90% more Tests!
</p>
<p>
BUGFIXES
</p>
<ul>
<li>Skynet Workers now restart properly when the worker_version changes.

</li>
<li>starting tuplespce_server, you no longer need to provide the &#8212;port if
you&#8216;re already providing the drburi-

</li>
<li>Fixed a bug where <a
href="../classes/Skynet/MessageQueueAdapter/Mysql.html">Skynet::MessageQueueAdapter::Mysql</a>
would sometimes pick up tasks another worker had already picked up.

</li>
<li>Fix bug in <a href="../classes/Skynet/Worker.html">Skynet::Worker</a> where
it wouldn&#8216;t die right if the max processed was reached.

</li>
<li>Workers were supposed to restart when the worker_version changed. They do
that properly now.

</li>
</ul>
<p>
Thanks to Jason Rimmer for finding these bugs.
</p>
<ul>
<li>Fix bug in <a href="../classes/Skynet/Message.html">Skynet::Message</a>
where it would calculate the iteration improperly.

</li>
<li>The skynet gem appears to be missing the Rubigen dependency

</li>
<li>Running skynet_install even without the rails arg still generates code with
rails dependencies and tailings: RAILS_ROOT, RAILS_ENV, and the various
directory tailings such as &#8216;db/migrate&#8217;, etc.

</li>
<li>Generated skynet script is missing &quot;require
&#8216;rubygems&#8217;&quot;

</li>
<li>Specification of pid directory and file is incorrect as
&#8216;skynet_manager.rb&#8217; wants only a directory with it specifying
the file

</li>
<li>The sleep while waiting to start the queue server isn&#8216;t long enough.
There is now a CONFIG setting TS_SERVER_START_DELAY.

</li>
</ul>
<h2>0.0.1 2007-12-16</h2>
<ul>
<li>1 major enhancement:

<ul>
<li>Initial release

</li>
</ul>
</li>
</ul>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>